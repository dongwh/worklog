<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="/plugin/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/plugin/tempo/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="/plugin/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css"/>
    <link href="/plugin/tempo/css/templatemo_style.css" rel="stylesheet" type="text/css"/>
    <script src="/plugin/jquery/jquery-2.1.4/jquery.min.js"></script>
    <script src="/plugin/layer/layer.js"></script>
    <script language="javascript" type="text/javascript" src="/date/My97DatePicker/WdatePicker.js"></script>


</head>
<body class="templatemo-bg-gray">
<div class="container">
    <h1 class="margin-bottom-15">日报</h1>
    <div class="space-4"></div>
    <div class="form-group" id="d_month">
        <label class="col-sm-3 control-label no-padding-right" >日报时间 : </label>
        <div class="col-sm-5">
            <input type="text" id="curDate" name="curDate" placeholder="日报时间" class="form-control" readonly="readonly" onClick="WdatePicker({ dateFmt: 'yyyy-MM', isShowToday: false, isShowClear: false,skin:'whyGreen',maxDate:'%y-%M-%d' })"/>
        </div>
    </div>
    <div class="space-4"></div>
    <div class="form-group" id="d_user">
        <label class="col-sm-3 control-label no-padding-right" for="username">汇报人 : </label>
        <div class="col-sm-5">
            <input type="hidden" id="code" name="code" th:value="${session.code}"/>
            <input type="text" id="username" name="username" class="form-control" readonly="readonly" th:value="${session.username}" />
        </div>
    </div>
    <div class="space-4"></div>
    <div class="form-group" id="d_reduce">
        <label class="col-sm-3 control-label no-padding-right" for="content">日报内容 : </label>
        <div class="col-sm-5">
            <input type="text" id="content" placeholder="日报内容" class="form-control"  />
        </div>
    </div>
    <div class="clearfix form-actions">
        <div class="col-md-offset-3 col-md-9" style="margin-top: 100px">
            <button class="btn btn-app btn-default" type="button" id="submitBtn" style="margin-left: 90px" th:onclick="'javascript:saveDate();'">
                <i class="ace-icon fa fa-undo bigger-150"></i>
                确认
            </button>
            <button class="btn btn-app btn-default" type="button" id="query" style="margin-left: 90px" th:onclick="'javascript:queryDate();'">
                <i class="ace-icon fa fa-undo bigger-150"></i>
                查询
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-body">
                    <table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                        <tr>
                            <th>日期</th>
                            <th>提交人</th>
                            <th>内容</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>



</div>
</div>
<script th:inline="javascript">


    function saveDate() {
        debugger;
        var curDate=$("#curDate").val();
        var content=$("#content").val();
        var userCode=$("#code").val();
        var userName=$("#username").val();

        document.getElementById("tradeType").innerHTML="";
        if(curDate == ""){
            layer.alert("请选择日期");
            return false;
        }
        if(content == ""){
            layer.alert("请输入工作内容");
            return false;
        }
        $.ajax({
            type: "post",
            url: "saveReport",
            dataType:'json',
            data: {
                curDate: curDate,
                content: content,
                userCode:userCode,
                userName:userName
            },
            success: function (data, status) {
                console.info(data);
                if(data.result_code=="success"){
                    window.location.href = "index";
                }else if(data.result_code=="error"){
                    layer.alert(data.message)
                }
            },
            <!--用户名密码验证失败-->
            error: function () {layer.alert("服务器错误")}
        });
    };


    function queryDate() {
        var curDate=$("#curDate").val();
        var myTable = datatableManager.dataObject = $('#example').dataTable($.extend({
            "ajax": function (data, callback, settings) {

            $.ajax({
            type: "post",
            url: "submitReport",
            dataType:'json',
            data: {
                curDate: curDate,
            },
            success: function (data) {
                console.info(data);
                if(data.result_code=="success"){
                    window.location.href = "index";
                }else if(data.result_code=="error"){
                    layer.alert(data.message)
                }
            },
            error: function () {layer.alert("服务器错误")}
            });
            },
        }, CONSTANT.DATA_TABLES.DEFAULT_OPTION)).api();


    };

</script>

</body>
</html>
